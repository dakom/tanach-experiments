var GEMATRIA_HILIGHT=function(t){function e(){n=t.filter,a(.5),i=t.minGematria,GEMATRIA_HILIGHT.Controls.SetGematria(t.minGematria),o=new PIXI.ticker.Ticker,o.add(r),o.start()}function a(t){s=c-t*c}function r(e){T||(u+=e,u>s&&(u=0,l?--i<t.minGematria&&(i=t.maxGematria):++i>t.maxGematria&&(i=t.minGematria),GEMATRIA_HILIGHT.Controls.SetGematria(i)))}var n,o,i,s,l=!1,T=!1,u=0,c=50;return t.Animation={Start:e,SetSpeed:a,IsPaused:function(){return T},TogglePause:function(){T=!T},ToggleRewind:function(){l=!l},IsRewind:function(){return l}},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(e){t.filter.numberValue=e,$("#gemval").val(e)}function a(){t.filter.bgColor=parseInt($("#bgColor").spectrum("get").toHex(),16),t.filter.matchColor=parseInt($("#matchColor").spectrum("get").toHex(),16)}function r(){a(),$("#bgColor").on("move.spectrum",a),$("#matchColor").on("move.spectrum",a),$("#bgColor").on("change.spectrum",a),$("#matchColor").on("change.spectrum",a),window.addEventListener("keydown",function(e){var a=e.keyCode;switch(a){case 70:t.sprite.scale.x*=-1}}),$("#speed").on("input",function(){GEMATRIA_HILIGHT.Animation.SetSpeed($("#speed").val()/100)}),$("#rewindMode").on("click",function(){GEMATRIA_HILIGHT.Animation.ToggleRewind(),GEMATRIA_HILIGHT.Animation.IsRewind()?$("#rewindMode").addClass("selected"):$("#rewindMode").removeClass("selected")}),$("#playMode").on("click",function(){GEMATRIA_HILIGHT.Animation.TogglePause(),$("#playMode").val(GEMATRIA_HILIGHT.Animation.IsPaused()?"Play":"Pause")}),$("#gemval").on("input",function(){var a=$("#gemval").val();a>=t.minGematria&&a<=t.maxGematria&&e(a)}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,a){var r=a.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(r.x=t.sprite.width-r.x);var n=(r.y-1)*t.sprite.width+r.x,o=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+r.x+","+r.y+" offset: "+n);var a=o[n];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[a.book],msg+="\nVerse "+a.pasuk,msg+="\nWord "+a.word,msg+="\nLetter "+a.letter,alert(msg)})}return t.Controls={SetGematria:e,Start:r,ResetColors:a},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(t){return Math.ceil(GEMATRIA_HILIGHT.allLetters.length/t)}return t.GetTextureHeight=e,t.GetGematriaTexture=function(t,e){for(var a,r=[],n=0,o=0;n<GEMATRIA_HILIGHT.allWords.length&&o<GEMATRIA_HILIGHT.allWords[n].length;){var i=GEMATRIA_HILIGHT.allWords[n];0==o&&(a=TXP.Utils.Gematria.CountHebArray(i)),r.push(a),++o==i.length&&(n++,o=0)}return TXP.Utils.Texture.CreateNumbers(t,e,r,function(t){0==t.data[0]&&3==t.data[1]&&145==t.data[2]?console.log("looks good from imgData side"):console.log("ERROR ON TEXTURE TEST!!!!!")})},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),t.maxGematria=0,t.minGematria=1640;for(var e=0;e<GEMATRIA_HILIGHT.allWords.length;e++){var a=TXP.Utils.Gematria.CountHebArray(GEMATRIA_HILIGHT.allWords[e]);a>t.maxGematria&&(t.maxGematria=a),a<t.minGematria&&(t.minGematria=a)}TXP.Init(window.innerWidth,GEMATRIA_HILIGHT.GetTextureHeight(window.innerWidth),GEMATRIA_HILIGHT.configOptions.bgColor),gematriaTexture=GEMATRIA_HILIGHT.GetGematriaTexture(TXP.canvasWidth,TXP.canvasHeight),console.log("Created Texture "+gematriaTexture.width+"x"+gematriaTexture.height),t.sprite=new PIXI.Sprite(gematriaTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new TXP.Shaders.MatchValueFilter,t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),GEMATRIA_HILIGHT.Animation.Start(),GEMATRIA_HILIGHT.Controls.Start()}return t.Start=function(a){t.configOptions=a;var r=2;TXP.TanachData.Books.Load({onComplete:function(){--r||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","value-match"]},{onComplete:function(){--r||e()}})},t}(GEMATRIA_HILIGHT||{}),LETTERS_PALETTE=function(t){function e(){return.1*Math.random()}function a(){for(n=t.filter,s=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,i=0;i<s;i++)l[i]={r:e(),g:e(),b:e()};o=new PIXI.ticker.Ticker,o.add(r),o.start()}function r(t){if(!T){var a=n.rPalette,r=n.gPalette,o=n.bPalette;for(i=0;i<s;i++){var u=a[i],c=r[i],d=o[i];u+=t*l[i].r,c+=t*l[i].g,d+=t*l[i].b,u>1?(u=1,l[i].r=e()*-1):u<.01&&(u=.01,l[i].r=e()),c>1?(c=1,l[i].g=e()*-1):c<.01&&(c=.01,l[i].g=e()),d>1?(d=1,l[i].b=e()*-1):d<.01&&(d=.01,l[i].b=e()),a[i]=u,r[i]=c,o[i]=d}}}var n,o,s,l=[],T=!1;return t.Animation={Start:a,TogglePause:function(){T=!T}},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){o>27?o=0:o<0&&(o=27),console.log("CHOSEN LETTER: "+TXP.Utils.TextSubstitution.TEXT_HEBREW[o]);for(var t=0;t<n;t++)0==o||t==o?r.aPalette[t]=1:r.aPalette[t]=0}function a(){r=t.filter,n=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,window.addEventListener("keydown",function(a){var n=a.keyCode;switch(console.log(n),n){case 32:LETTERS_PALETTE.Animation.TogglePause();break;case 38:o++,e();break;case 40:o--,e();break;case 49:r.substitution=0;break;case 50:r.substitution=1;break;case 51:r.substitution=2;break;case 70:t.sprite.scale.x*=-1}}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,a){var r=a.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(r.x=t.sprite.width-r.x);var n=(r.y-1)*t.sprite.width+r.x,o=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+r.x+","+r.y+" offset: "+n);var a=o[n];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[a.book],msg+="\nVerse "+a.pasuk,msg+="\nWord "+a.word,msg+="\nLetter "+a.letter,alert(msg)})}var r,n,o=0;return t.Input={Start:a},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){var e=function(t,e){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("letters-palette"),{rPalette:{value:t.rPalette},gPalette:{value:t.gPalette},bPalette:{value:t.bPalette},aPalette:{value:t.aPalette},substitution:{value:e}})};return e.prototype=Object.create(PIXI.Filter.prototype),e.prototype.constructor=e,Object.defineProperties(e.prototype,{rPalette:{get:function(){return this.uniforms.rPalette},set:function(t){this.uniforms.rPalette=t}},gPalette:{get:function(){return this.uniforms.gPalette},set:function(t){this.uniforms.gPalette=t}},bPalette:{get:function(){return this.uniforms.bPalette},set:function(t){this.uniforms.bPalette=t}},aPalette:{get:function(){return this.uniforms.aPalette},set:function(t){this.uniforms.aPalette=t}},substitution:{get:function(){return this.uniforms.substitution},set:function(t){this.uniforms.substitution=t}}}),t.LettersFilter=e,t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(e){return Math.ceil(t.allLetters.length/e)}return t.GetTextureHeight=e,t.GetLettersTexture=function(a){var r=t.allLetters,n=e(a),o=document.createElement("canvas");o.width=a,o.height=n;for(var i=function(){return void 0==o.getContext?G_vmlCanvasManager.initElement(o).getContext("2d"):o.getContext("2d")}(),s=i.createImageData(o.width,o.height),l=0,T=0;l<r.length;l++){var u=r[l],c=TXP.Utils.TextSubstitution.SUBSTITUTION_ATBASH[u],d=TXP.Utils.TextSubstitution.SUBSTITUTION_ALBAM[u];s.data[T++]=u,s.data[T++]=c,s.data[T++]=d,s.data[T++]=255}return i.putImageData(s,0,0),PIXI.Texture.fromCanvas(o)},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),TXP.Init(window.innerWidth,LETTERS_PALETTE.GetTextureHeight(window.innerWidth),LETTERS_PALETTE.configOptions.bgColor),lettersTexture=LETTERS_PALETTE.GetLettersTexture(TXP.canvasWidth),console.log("Created Texture "+lettersTexture.width+"x"+lettersTexture.height);var e=a();t.sprite=new PIXI.Sprite(lettersTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new LETTERS_PALETTE.LettersFilter(e,0),t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),LETTERS_PALETTE.Animation.Start(),LETTERS_PALETTE.Input.Start()}function a(){for(var t=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,e=[],a=[],r=[],n=[],o=0;o<t;o++)e[o]=Math.random(),a[o]=Math.random(),r[o]=Math.random(),n[o]=1;return{rPalette:e,gPalette:a,bPalette:r,aPalette:n}}return t.Start=function(a){t.configOptions=a;var r=2;TXP.TanachData.Books.Load({onComplete:function(){--r||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","letters-palette"]},{onComplete:function(){--r||e()}})},t}(LETTERS_PALETTE||{}),RATIO_DRAW=function(t){function e(t,e){var a=document.createElement("canvas");a.width=TXP.canvasWidth,a.height=TXP.canvasHeight;for(var r=function(){return void 0==a.getContext?G_vmlCanvasManager.initElement(a).getContext("2d"):a.getContext("2d")}(),n=r.createImageData(a.width,a.height),o=0,i=0;i<t.length;i++)t[i]>o&&(o=t[i]);for(var s=16777215,l=0,i=0;i<n.data.length;i+=4){l>t.length&&(l=0);var T=t[l++];if(1==e.method){var u=T/o,c=u*s,d=Math.floor(c/65536),I=Math.floor(c/256)%256,f=c%256;n.data[i+0]=d,n.data[i+1]=I,n.data[i+2]=f,n.data[i+3]=255}}return r.putImageData(n,0,0),PIXI.Texture.fromCanvas(a)}var a=function(t){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("ratio"),{gSampler:{type:"sampler2D",value:t}})};return a.prototype=Object.create(PIXI.Filter.prototype),a.prototype.constructor=a,Object.defineProperties(a.prototype,{gTexture:{get:function(){return this.uniforms.gSampler},set:function(t){console.log("Changed in filter!"),this.uniforms.gSampler=t}}}),t.DrawGematriaImage=function(t){var r=e(t,{method:1}),n=new PIXI.Graphics;n.beginFill(16777215),n.drawRect(0,0,r.width,r.height),n.endFill();var o=new a(r);n.filters=[o],TXP.stage.addChild(n)},t}(RATIO_DRAW||{}),RATIO_DRAW=function(t){function e(){var t=TXP.TanachData.SeparateBooks.GetFlattened({benchMark:!0,gematriaPerLetter:!0});RATIO_DRAW.DrawGematriaImage(t)}return t.Start=function(a){t.configOptions=a,TXP.Init(window.innerWidth,window.innerHeight,a.bgColor);var r=2;TXP.TanachData.SeparateBooks.Load({onComplete:function(){--r||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","ratio"]},{onComplete:function(){--r||e()}})},t}(RATIO_DRAW||{}),TESTS=function(t){var e=304801,a=1196838;return t.BookTest=function(){for(var t=0,r=5,n=TXP.TanachData.Books.GetData(),o=0;o<5;o++)for(var i=n[o],s=0;s<i.length;s++)for(var l=i[s],T=0;T<l.length;T++)for(var u=l[T],c=0;c<u.length;c++){u[c];t++}t!=e?alert("CHUMASH BOOK TEST FAILED!"):console.log("CHUMASH BOOK TEST PASSED!"),t=0,r=n.length;for(var o=0;o<r;o++)for(var i=n[o],s=0;s<i.length;s++)for(var l=i[s],T=0;T<l.length;T++)for(var u=l[T],c=0;c<u.length;c++){u[c];t++}t!=a?alert("TANACH BOOK TEST FAILED!"):console.log("TANACH BOOK TEST PASSED!")},t.SeparateBookTest=function(){for(var t=TXP.TanachData.SeparateBooks.names,r=0,n=5,o=0;o<n;o++)for(var i=t[o],s=TXP.TanachData.SeparateBooks.GetData(i),l=0;l<s.length;l++)for(var T=s[l],u=0;u<T.length;u++)for(var c=T[u],d=0;d<c.length;d++){c[d];r++}r!=e?alert("CHUMASH BOOK TEST FAILED!"):console.log("CHUMASH BOOK TEST PASSED!"),r=0,n=t.length;for(var o=0;o<n;o++)for(var i=t[o],s=TXP.TanachData.SeparateBooks.GetData(i),l=0;l<s.length;l++)for(var T=s[l],u=0;u<T.length;u++)for(var c=T[u],d=0;d<c.length;d++){c[d];r++}r!=a?alert("TANACH BOOK TEST FAILED!"):console.log("TANACH BOOK TEST PASSED!")},t.LettersTest=function(){var t=TXP.TanachData.Letters.GetData().length;t!=a?alert("TANACH LETTERS TEST FAILED! "+t):console.log("TANACH LETTERS TEST PASSED!")},t}(TESTS||{}),WORD_HILIGHT=function(t){function e(){o=t.filter,r(.5),s=0,a(s),i=new PIXI.ticker.Ticker,i.add(n),i.start()}function a(t){WORD_HILIGHT.Controls.SetWord(TXP.Utils.TextSubstitution.GetTextFromArray(WORD_HILIGHT.allWords[t]))}function r(t){l=d-t*d}function n(t){u||(c+=t,c>l&&(c=0,T?--s<0&&(s=WORD_HILIGHT.allWords.length-1):++s>WORD_HILIGHT.allWords.length&&(s=0),a(s)))}var o,i,s,l,T=!1,u=!1,c=0,d=50;return t.Animation={Start:e,SetSpeed:r,IsPaused:function(){return u},TogglePause:function(){u=!u},ToggleRewind:function(){T=!T},IsRewind:function(){return T}},t}(WORD_HILIGHT||{}),WORD_HILIGHT=function(t){function e(e){t.wordLookup.hasOwnProperty(e)&&(t.filter.numberValue=t.wordLookup[e],$("#wordval").val(e))}function a(){t.filter.bgColor=parseInt($("#bgColor").spectrum("get").toHex(),16),t.filter.matchColor=parseInt($("#matchColor").spectrum("get").toHex(),16)}function r(){a(),$("#bgColor").on("move.spectrum",a),$("#matchColor").on("move.spectrum",a),$("#bgColor").on("change.spectrum",a),$("#matchColor").on("change.spectrum",a),window.addEventListener("keydown",function(e){var a=e.keyCode;switch(a){case 70:t.sprite.scale.x*=-1}}),$("#speed").on("input",function(){WORD_HILIGHT.Animation.SetSpeed($("#speed").val()/100)}),$("#playMode").on("click",function(){WORD_HILIGHT.Animation.TogglePause(),$("#playMode").val(WORD_HILIGHT.Animation.IsPaused()?"Play":"Pause")}),$("#rewindMode").on("click",function(){WORD_HILIGHT.Animation.ToggleRewind(),WORD_HILIGHT.Animation.IsRewind()?$("#rewindMode").addClass("selected"):$("#rewindMode").removeClass("selected")}),$("#wordval").on("input",function(){var a=$("#wordval").val();t.wordLookup.hasOwnProperty(a)&&e(a)}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,a){var r=a.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(r.x=t.sprite.width-r.x);var n=(r.y-1)*t.sprite.width+r.x,o=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+r.x+","+r.y+" offset: "+n);var a=o[n];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[a.book],msg+="\nVerse "+a.pasuk,msg+="\nWord "+a.word,msg+="\nLetter "+a.letter,alert(msg)})}return t.Controls={SetWord:e,Start:r,ResetColors:a},t}(WORD_HILIGHT||{}),WORD_HILIGHT=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),TXP.Init(window.innerWidth,WORD_HILIGHT.GetTextureHeight(window.innerWidth),WORD_HILIGHT.configOptions.bgColor),wordsTexture=WORD_HILIGHT.GetWordsTexture(TXP.canvasWidth,TXP.canvasHeight),t.sprite=new PIXI.Sprite(wordsTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new TXP.Shaders.MatchValueFilter,t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),WORD_HILIGHT.Animation.Start(),WORD_HILIGHT.Controls.Start()}return t.Start=function(a){t.configOptions=a;var r=2;TXP.TanachData.Books.Load({onComplete:function(){--r||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","value-match"]},{onComplete:function(){--r||e()}})},t}(WORD_HILIGHT||{}),WORD_HILIGHT=function(t){function e(t){return Math.ceil(WORD_HILIGHT.allLetters.length/t)}return t.GetTextureHeight=e,t.GetWordsTexture=function(e,a){for(var r,n=0,o=0,i={},s=0,l=[];n<WORD_HILIGHT.allWords.length&&o<WORD_HILIGHT.allWords[n].length;){var T=WORD_HILIGHT.allWords[n];0==o&&(r=TXP.Utils.TextSubstitution.GetTextFromArray(T),i.hasOwnProperty(r)||(i[r]=s++)),l.push(i[r]),++o==T.length&&(n++,o=0)}return t.wordLookup=i,TXP.Utils.Texture.CreateNumbers(e,a,l,function(t){var e=WORD_HILIGHT.allWords[4],a=i[TXP.Utils.TextSubstitution.GetTextFromArray(e)],r=WORD_HILIGHT.allWords[0].concat(WORD_HILIGHT.allWords[1]).concat(WORD_HILIGHT.allWords[2]).concat(WORD_HILIGHT.allWords[3]).length;r*=4,4==a&&"השמים"==TXP.Utils.TextSubstitution.GetTextFromArray(e)||console.log("WRONG TEST WORD INDEX!"),(a>>16&255)==t.data[r]&&(a>>8&255)==t.data[r+1]&&(255&a)==t.data[r+2]?console.log("looks good from imgData side"):console.log("ERROR ON TEXTURE TEST!!!!!")})},t}(WORD_HILIGHT||{});