var LETTERS_PALETTE=function(t){function e(){return.1*Math.random()}function a(){for(r=t.filter,T=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,i=0;i<T;i++)u[i]={r:e(),g:e(),b:e()};o=new PIXI.ticker.Ticker,o.add(n),o.start()}function n(t){if(!l){var a=r.rPalette,n=r.gPalette,o=r.bPalette;for(i=0;i<T;i++){var s=a[i],E=n[i],c=o[i];s+=t*u[i].r,E+=t*u[i].g,c+=t*u[i].b,s>1?(s=1,u[i].r=e()*-1):s<.01&&(s=.01,u[i].r=e()),E>1?(E=1,u[i].g=e()*-1):E<.01&&(E=.01,u[i].g=e()),c>1?(c=1,u[i].b=e()*-1):c<.01&&(c=.01,u[i].b=e()),a[i]=s,n[i]=E,o[i]=c}}}var r,o,T,u=[],l=!1;return t.Animation={Start:a,TogglePause:function(){l=!l}},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){i>27?i=0:i<0&&(i=27),console.log("CHOSEN LETTER: "+TXP.Utils.TextSubstitution.TEXT_HEBREW[i]);for(var t=0;t<r;t++)0==i||t==i?n.aPalette[t]=1:n.aPalette[t]=0}function a(){n=t.filter,r=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,window.addEventListener("keydown",function(t){var a=t.keyCode;switch(a){case 32:LETTERS_PALETTE.Animation.TogglePause();break;case 38:i++,e();break;case 40:i--,e();break;case 49:n.substitution=0;break;case 50:n.substitution=1;break;case 51:n.substitution=2}})}var n,r,i=0;return t.Input={Start:a},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){var e=function(t,e){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("letters-palette"),{rPalette:{value:t.rPalette},gPalette:{value:t.gPalette},bPalette:{value:t.bPalette},aPalette:{value:t.aPalette},substitution:{value:e}})};return e.prototype=Object.create(PIXI.Filter.prototype),e.prototype.constructor=e,Object.defineProperties(e.prototype,{rPalette:{get:function(){return this.uniforms.rPalette},set:function(t){this.uniforms.rPalette=t}},gPalette:{get:function(){return this.uniforms.gPalette},set:function(t){this.uniforms.gPalette=t}},bPalette:{get:function(){return this.uniforms.bPalette},set:function(t){this.uniforms.bPalette=t}},aPalette:{get:function(){return this.uniforms.aPalette},set:function(t){this.uniforms.aPalette=t}},substitution:{get:function(){return this.uniforms.substitution},set:function(t){this.uniforms.substitution=t}}}),t.LettersFilter=e,t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(t){return Math.ceil(TXP.TanachData.Letters.GetData().length/t)}return t.GetTextureHeight=e,t.GetLettersTexture=function(t){var a=TXP.TanachData.Letters.GetData(),n=e(t),r=document.createElement("canvas");r.width=t,r.height=n;for(var i=function(){return void 0==r.getContext?G_vmlCanvasManager.initElement(r).getContext("2d"):r.getContext("2d")}(),o=i.createImageData(r.width,r.height),T=0,u=0;T<a.length;T++){var l=a[T],s=TXP.Utils.TextSubstitution.SUBSTITUTION_ATBASH[l],E=TXP.Utils.TextSubstitution.SUBSTITUTION_ALBAM[l];o.data[u++]=l,o.data[u++]=s,o.data[u++]=E,o.data[u++]=255}return i.putImageData(o,0,0),PIXI.Texture.fromCanvas(r)},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){TXP.Init(window.innerWidth,LETTERS_PALETTE.GetTextureHeight(window.innerWidth),LETTERS_PALETTE.configOptions.bgColor),lettersTexture=LETTERS_PALETTE.GetLettersTexture(TXP.canvasWidth),console.log("Created Texture "+lettersTexture.width+"x"+lettersTexture.height);var e=a(),n=new PIXI.Sprite(lettersTexture);t.filter=new LETTERS_PALETTE.LettersFilter(e,0),n.filters=[t.filter],TXP.stage.addChild(n),LETTERS_PALETTE.Animation.Start(),LETTERS_PALETTE.Input.Start()}function a(){for(var t=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,e=[],a=[],n=[],r=[],i=0;i<t;i++)e[i]=Math.random(),a[i]=Math.random(),n[i]=Math.random(),r[i]=1;return{rPalette:e,gPalette:a,bPalette:n,aPalette:r}}return t.Start=function(a){t.configOptions=a;var n=2;TXP.TanachData.Letters.Load({onComplete:function(){--n||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","letters-palette"]},{onComplete:function(){--n||e()}})},t}(LETTERS_PALETTE||{}),RATIO_DRAW=function(t){function e(t,e){var a=document.createElement("canvas");a.width=TXP.canvasWidth,a.height=TXP.canvasHeight;for(var n=function(){return void 0==a.getContext?G_vmlCanvasManager.initElement(a).getContext("2d"):a.getContext("2d")}(),r=n.createImageData(a.width,a.height),i=0,o=0;o<t.length;o++)t[o]>i&&(i=t[o]);for(var T=16777215,u=0,o=0;o<r.data.length;o+=4){u>t.length&&(u=0);var l=t[u++];if(1==e.method){var s=l/i,E=s*T,c=Math.floor(E/65536),f=Math.floor(E/256)%256,P=E%256;r.data[o+0]=c,r.data[o+1]=f,r.data[o+2]=P,r.data[o+3]=255}}return n.putImageData(r,0,0),PIXI.Texture.fromCanvas(a)}var a=function(t){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("default"),{gSampler:{type:"sampler2D",value:t}})};return a.prototype=Object.create(PIXI.Filter.prototype),a.prototype.constructor=a,Object.defineProperties(a.prototype,{gTexture:{get:function(){return this.uniforms.gSampler},set:function(t){console.log("Changed in filter!"),this.uniforms.gSampler=t}}}),t.DrawGematriaImage=function(t){var n=e(t,{method:1}),r=new PIXI.Graphics;r.beginFill(16777215),r.drawRect(0,0,n.width,n.height),r.endFill();var i=new a(n);r.filters=[i],TXP.stage.addChild(r)},t}(RATIO_DRAW||{}),RATIO_DRAW=function(t){function e(){var t=TXP.TanachData.Books.GetFlattened({benchMark:!0,gematriaPerLetter:!0});RATIO_DRAW.DrawGematriaImage(t)}return t.Start=function(a){t.configOptions=a,TXP.Init(window.innerWidth,window.innerHeight,a.bgColor);var n=2;TXP.TanachData.Books.Load({onComplete:function(){--n||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default"]},{onComplete:function(){--n||e()}})},t}(RATIO_DRAW||{}),TESTS=function(t){var e=304801,a=1196838;return t.BookTest=function(){for(var t=TXP.TanachData.Books.names,n=0,r=5,i=0;i<r;i++)for(var o=t[i],T=TXP.TanachData.Books.GetData(o),u=0;u<T.length;u++)for(var l=T[u],s=0;s<l.length;s++)for(var E=l[s],c=0;c<E.length;c++){E[c];n++}n!=e?alert("CHUMASH BOOK TEST FAILED!"):console.log("CHUMASH BOOK TEST PASSED!"),n=0,r=t.length;for(var i=0;i<r;i++)for(var o=t[i],T=TXP.TanachData.Books.GetData(o),u=0;u<T.length;u++)for(var l=T[u],s=0;s<l.length;s++)for(var E=l[s],c=0;c<E.length;c++){E[c];n++}n!=a?alert("TANACH BOOK TEST FAILED!"):console.log("TANACH BOOK TEST PASSED!")},t.LettersTest=function(){var t=TXP.TanachData.Letters.GetData().length;t!=a?alert("TANACH LETTERS TEST FAILED! "+t):console.log("TANACH LETTERS TEST PASSED!")},t}(TESTS||{});