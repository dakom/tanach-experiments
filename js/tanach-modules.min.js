var GEMATRIA_HILIGHT=function(t){function e(){r=t.filter,i=t.minGematria,GEMATRIA_HILIGHT.Controls.SetGematria(t.minGematria,l),n=new PIXI.ticker.Ticker,n.add(a),n.start()}function a(e){o||(s+=e,s>T&&(s=0,++i>t.maxGematria&&(i=t.minGematria),GEMATRIA_HILIGHT.Controls.SetGematria(i,l)))}var r,n,i,o=!1,T=5,s=0,l=!0;return t.Animation={Start:e,TogglePause:function(){o=!o},ToggleColorLock:function(){l=!l},IsColorChange:function(){return l},Faster:function(){T-=1,T<0&&(T=0)},Slower:function(){T+=1,T>100&&(T=100)}},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(e){t.filter.gematria=e,1==GEMATRIA_HILIGHT.Animation.IsColorChange()&&(t.filter.hilightColor=[Math.random(),Math.random(),Math.random(),1]),$("#gemval").text(e)}function a(){window.addEventListener("keydown",function(e){var a=e.keyCode;switch(a){case 32:GEMATRIA_HILIGHT.Animation.TogglePause();break;case 38:GEMATRIA_HILIGHT.Animation.Faster();break;case 40:GEMATRIA_HILIGHT.Animation.Slower();break;case 70:t.sprite.scale.x*=-1;break;case 67:GEMATRIA_HILIGHT.Animation.ToggleColorLock()}}),$("#ingem").on("input",function(){var a=$("#ingem").val();a>=t.minGematria&&a<=t.maxGematria&&e(a)}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,a){var r=a.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(r.x=t.sprite.width-r.x);var n=(r.y-1)*t.sprite.width+r.x,i=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+r.x+","+r.y+" offset: "+n);var a=i[n];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[a.book],msg+="\nVerse "+a.pasuk,msg+="\nWord "+a.word,msg+="\nLetter "+a.letter,alert(msg)})}return t.Controls={SetGematria:e,Start:a},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){var e=function(t){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("gematria-hilight"),{gematriaHigh:{value:0},gematriaLow:{value:0},hilightColor:{value:[1,1,0,1]}})};return e.prototype=Object.create(PIXI.Filter.prototype),e.prototype.constructor=e,Object.defineProperties(e.prototype,{gematria:{get:function(){var t=255*this.uniforms.gematriaHigh<<8&255,e=255*this.uniforms.gematriaLow&255;return t+e},set:function(t){this.uniforms.gematriaHigh=(t>>8&255)/255,this.uniforms.gematriaLow=(255&t)/255}},hilightColor:{get:function(){return this.uniforms.hilightColor},set:function(t){this.uniforms.hilightColor=t}}}),t.GematriaFilter=e,t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(t){return Math.ceil(GEMATRIA_HILIGHT.allLetters.length/t)}return t.GetTextureHeight=e,t.GetGematriaTexture=function(t){var a=e(t),r=document.createElement("canvas");r.width=t,r.height=a;for(var n=function(){return void 0==r.getContext?G_vmlCanvasManager.initElement(r).getContext("2d"):r.getContext("2d")}(),i=n.createImageData(r.width,r.height),o=0,T=0,s=0,l=!1;!l;){var u=GEMATRIA_HILIGHT.allWords[o];u[s++];s==u.length&&(o++,s=0),o==GEMATRIA_HILIGHT.allWords.length&&(l=!0);var c=TXP.Utils.Gematria.CountHebArray(u);i.data[T++]=c>>8&255,i.data[T++]=255&c,i.data[T++]=0,i.data[T++]=255}return 3==i.data[0]&&145==i.data[1]?console.log("looks good from imgData side"):console.log("error on imgData side"),n.putImageData(i,0,0),PIXI.Texture.fromCanvas(r)},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),t.maxGematria=0,t.minGematria=1640;for(var e=0;e<GEMATRIA_HILIGHT.allWords.length;e++){var a=TXP.Utils.Gematria.CountHebArray(GEMATRIA_HILIGHT.allWords[e]);a>t.maxGematria&&(t.maxGematria=a),a<t.minGematria&&(t.minGematria=a)}TXP.Init(window.innerWidth,GEMATRIA_HILIGHT.GetTextureHeight(window.innerWidth),GEMATRIA_HILIGHT.configOptions.bgColor),gematriaTexture=GEMATRIA_HILIGHT.GetGematriaTexture(TXP.canvasWidth),console.log("Created Texture "+gematriaTexture.width+"x"+gematriaTexture.height),t.sprite=new PIXI.Sprite(gematriaTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new GEMATRIA_HILIGHT.GematriaFilter,t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),GEMATRIA_HILIGHT.Animation.Start(),GEMATRIA_HILIGHT.Controls.Start()}return t.Start=function(a){t.configOptions=a;var r=2;TXP.TanachData.Books.Load({onComplete:function(){--r||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","gematria-hilight"]},{onComplete:function(){--r||e()}})},t}(GEMATRIA_HILIGHT||{}),LETTERS_PALETTE=function(t){function e(){return.1*Math.random()}function a(){for(n=t.filter,T=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,i=0;i<T;i++)s[i]={r:e(),g:e(),b:e()};o=new PIXI.ticker.Ticker,o.add(r),o.start()}function r(t){if(!l){var a=n.rPalette,r=n.gPalette,o=n.bPalette;for(i=0;i<T;i++){var u=a[i],c=r[i],g=o[i];u+=t*s[i].r,c+=t*s[i].g,g+=t*s[i].b,u>1?(u=1,s[i].r=e()*-1):u<.01&&(u=.01,s[i].r=e()),c>1?(c=1,s[i].g=e()*-1):c<.01&&(c=.01,s[i].g=e()),g>1?(g=1,s[i].b=e()*-1):g<.01&&(g=.01,s[i].b=e()),a[i]=u,r[i]=c,o[i]=g}}}var n,o,T,s=[],l=!1;return t.Animation={Start:a,TogglePause:function(){l=!l}},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){i>27?i=0:i<0&&(i=27),console.log("CHOSEN LETTER: "+TXP.Utils.TextSubstitution.TEXT_HEBREW[i]);for(var t=0;t<n;t++)0==i||t==i?r.aPalette[t]=1:r.aPalette[t]=0}function a(){r=t.filter,n=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,window.addEventListener("keydown",function(a){var n=a.keyCode;switch(console.log(n),n){case 32:LETTERS_PALETTE.Animation.TogglePause();break;case 38:i++,e();break;case 40:i--,e();break;case 49:r.substitution=0;break;case 50:r.substitution=1;break;case 51:r.substitution=2;break;case 70:t.sprite.scale.x*=-1}}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,a){var r=a.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(r.x=t.sprite.width-r.x);var n=(r.y-1)*t.sprite.width+r.x,i=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+r.x+","+r.y+" offset: "+n);var a=i[n];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[a.book],msg+="\nVerse "+a.pasuk,msg+="\nWord "+a.word,msg+="\nLetter "+a.letter,alert(msg)})}var r,n,i=0;return t.Input={Start:a},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){var e=function(t,e){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("letters-palette"),{rPalette:{value:t.rPalette},gPalette:{value:t.gPalette},bPalette:{value:t.bPalette},aPalette:{value:t.aPalette},substitution:{value:e}})};return e.prototype=Object.create(PIXI.Filter.prototype),e.prototype.constructor=e,Object.defineProperties(e.prototype,{rPalette:{get:function(){return this.uniforms.rPalette},set:function(t){this.uniforms.rPalette=t}},gPalette:{get:function(){return this.uniforms.gPalette},set:function(t){this.uniforms.gPalette=t}},bPalette:{get:function(){return this.uniforms.bPalette},set:function(t){this.uniforms.bPalette=t}},aPalette:{get:function(){return this.uniforms.aPalette},set:function(t){this.uniforms.aPalette=t}},substitution:{get:function(){return this.uniforms.substitution},set:function(t){this.uniforms.substitution=t}}}),t.LettersFilter=e,t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(e){return Math.ceil(t.allLetters.length/e)}return t.GetTextureHeight=e,t.GetLettersTexture=function(a){var r=t.allLetters,n=e(a),i=document.createElement("canvas");i.width=a,i.height=n;for(var o=function(){return void 0==i.getContext?G_vmlCanvasManager.initElement(i).getContext("2d"):i.getContext("2d")}(),T=o.createImageData(i.width,i.height),s=0,l=0;s<r.length;s++){var u=r[s],c=TXP.Utils.TextSubstitution.SUBSTITUTION_ATBASH[u],g=TXP.Utils.TextSubstitution.SUBSTITUTION_ALBAM[u];T.data[l++]=u,T.data[l++]=c,T.data[l++]=g,T.data[l++]=255}return o.putImageData(T,0,0),PIXI.Texture.fromCanvas(i)},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),TXP.Init(window.innerWidth,LETTERS_PALETTE.GetTextureHeight(window.innerWidth),LETTERS_PALETTE.configOptions.bgColor),lettersTexture=LETTERS_PALETTE.GetLettersTexture(TXP.canvasWidth),console.log("Created Texture "+lettersTexture.width+"x"+lettersTexture.height);var e=a();t.sprite=new PIXI.Sprite(lettersTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new LETTERS_PALETTE.LettersFilter(e,0),t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),LETTERS_PALETTE.Animation.Start(),LETTERS_PALETTE.Input.Start()}function a(){for(var t=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,e=[],a=[],r=[],n=[],i=0;i<t;i++)e[i]=Math.random(),a[i]=Math.random(),r[i]=Math.random(),n[i]=1;return{rPalette:e,gPalette:a,bPalette:r,aPalette:n}}return t.Start=function(a){t.configOptions=a;var r=2;TXP.TanachData.Books.Load({onComplete:function(){--r||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","letters-palette"]},{onComplete:function(){--r||e()}})},t}(LETTERS_PALETTE||{}),TESTS=function(t){var e=304801,a=1196838;return t.BookTest=function(){for(var t=0,r=5,n=TXP.TanachData.Books.GetData(),i=0;i<5;i++)for(var o=n[i],T=0;T<o.length;T++)for(var s=o[T],l=0;l<s.length;l++)for(var u=s[l],c=0;c<u.length;c++){u[c];t++}t!=e?alert("CHUMASH BOOK TEST FAILED!"):console.log("CHUMASH BOOK TEST PASSED!"),t=0,r=n.length;for(var i=0;i<r;i++)for(var o=n[i],T=0;T<o.length;T++)for(var s=o[T],l=0;l<s.length;l++)for(var u=s[l],c=0;c<u.length;c++){u[c];t++}t!=a?alert("TANACH BOOK TEST FAILED!"):console.log("TANACH BOOK TEST PASSED!")},t.SeparateBookTest=function(){for(var t=TXP.TanachData.SeparateBooks.names,r=0,n=5,i=0;i<n;i++)for(var o=t[i],T=TXP.TanachData.SeparateBooks.GetData(o),s=0;s<T.length;s++)for(var l=T[s],u=0;u<l.length;u++)for(var c=l[u],g=0;g<c.length;g++){c[g];r++}r!=e?alert("CHUMASH BOOK TEST FAILED!"):console.log("CHUMASH BOOK TEST PASSED!"),r=0,n=t.length;for(var i=0;i<n;i++)for(var o=t[i],T=TXP.TanachData.SeparateBooks.GetData(o),s=0;s<T.length;s++)for(var l=T[s],u=0;u<l.length;u++)for(var c=l[u],g=0;g<c.length;g++){c[g];r++}r!=a?alert("TANACH BOOK TEST FAILED!"):console.log("TANACH BOOK TEST PASSED!")},t.LettersTest=function(){var t=TXP.TanachData.Letters.GetData().length;t!=a?alert("TANACH LETTERS TEST FAILED! "+t):console.log("TANACH LETTERS TEST PASSED!")},t}(TESTS||{}),RATIO_DRAW=function(t){function e(t,e){var a=document.createElement("canvas");a.width=TXP.canvasWidth,a.height=TXP.canvasHeight;for(var r=function(){return void 0==a.getContext?G_vmlCanvasManager.initElement(a).getContext("2d"):a.getContext("2d")}(),n=r.createImageData(a.width,a.height),i=0,o=0;o<t.length;o++)t[o]>i&&(i=t[o]);for(var T=16777215,s=0,o=0;o<n.data.length;o+=4){s>t.length&&(s=0);var l=t[s++];if(1==e.method){var u=l/i,c=u*T,g=Math.floor(c/65536),h=Math.floor(c/256)%256,f=c%256;n.data[o+0]=g,n.data[o+1]=h,n.data[o+2]=f,n.data[o+3]=255}}return r.putImageData(n,0,0),PIXI.Texture.fromCanvas(a)}var a=function(t){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("ratio"),{gSampler:{type:"sampler2D",value:t}})};return a.prototype=Object.create(PIXI.Filter.prototype),a.prototype.constructor=a,Object.defineProperties(a.prototype,{gTexture:{get:function(){return this.uniforms.gSampler},set:function(t){console.log("Changed in filter!"),this.uniforms.gSampler=t}}}),t.DrawGematriaImage=function(t){var r=e(t,{method:1}),n=new PIXI.Graphics;n.beginFill(16777215),n.drawRect(0,0,r.width,r.height),n.endFill();var i=new a(r);n.filters=[i],TXP.stage.addChild(n)},t}(RATIO_DRAW||{}),RATIO_DRAW=function(t){function e(){var t=TXP.TanachData.SeparateBooks.GetFlattened({benchMark:!0,gematriaPerLetter:!0});RATIO_DRAW.DrawGematriaImage(t)}return t.Start=function(a){t.configOptions=a,TXP.Init(window.innerWidth,window.innerHeight,a.bgColor);var r=2;TXP.TanachData.SeparateBooks.Load({onComplete:function(){--r||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","ratio"]},{onComplete:function(){--r||e()}})},t}(RATIO_DRAW||{});