var GEMATRIA_HILIGHT=function(t){function e(){o=t.filter,n(.5),i=t.minGematria,GEMATRIA_HILIGHT.Controls.SetGematria(t.minGematria),r=new PIXI.ticker.Ticker,r.add(a),r.start()}function n(t){l=c-t*c}function a(e){u||(T+=e,T>l&&(T=0,s?--i<t.minGematria&&(i=t.maxGematria):++i>t.maxGematria&&(i=t.minGematria),GEMATRIA_HILIGHT.Controls.SetGematria(i)))}var o,r,i,l,s=!1,u=!1,T=0,c=50;return t.Animation={Start:e,SetSpeed:n,IsPaused:function(){return u},TogglePause:function(){u=!u},ToggleRewind:function(){s=!s},IsRewind:function(){return s}},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(e){t.filter.numberValue=e,$("#gemval").val(e)}function n(){t.filter.bgColor=parseInt($("#bgColor").spectrum("get").toHex(),16),t.filter.matchColor=parseInt($("#matchColor").spectrum("get").toHex(),16)}function a(){n(),$("#bgColor").on("move.spectrum",n),$("#matchColor").on("move.spectrum",n),$("#bgColor").on("change.spectrum",n),$("#matchColor").on("change.spectrum",n),window.addEventListener("keydown",function(e){var n=e.keyCode;switch(n){case 70:t.sprite.scale.x*=-1}}),$("#speed").on("input",function(){GEMATRIA_HILIGHT.Animation.SetSpeed($("#speed").val()/100)}),$("#rewindMode").on("click",function(){GEMATRIA_HILIGHT.Animation.ToggleRewind(),GEMATRIA_HILIGHT.Animation.IsRewind()?$("#rewindMode").addClass("selected"):$("#rewindMode").removeClass("selected")}),$("#playMode").on("click",function(){GEMATRIA_HILIGHT.Animation.TogglePause(),$("#playMode").val(GEMATRIA_HILIGHT.Animation.IsPaused()?"Play":"Pause")}),$("#gemval").on("input",function(){var n=$("#gemval").val();n>=t.minGematria&&n<=t.maxGematria&&e(n)}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,n){var a=n.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(a.x=t.sprite.width-a.x);var o=(a.y-1)*t.sprite.width+a.x,r=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+a.x+","+a.y+" offset: "+o);var n=r[o];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[n.book],msg+="\nVerse "+n.pasuk,msg+="\nWord "+n.word,msg+="\nLetter "+n.letter,alert(msg)})}return t.Controls={SetGematria:e,Start:a,ResetColors:n},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(t){return Math.ceil(GEMATRIA_HILIGHT.allLetters.length/t)}return t.GetTextureHeight=e,t.GetGematriaTexture=function(t,e){for(var n,a=[],o=0,r=0;o<GEMATRIA_HILIGHT.allWords.length&&r<GEMATRIA_HILIGHT.allWords[o].length;){var i=GEMATRIA_HILIGHT.allWords[o];0==r&&(n=TXP.Utils.Gematria.CountHebArray(i)),a.push(n),++r==i.length&&(o++,r=0)}return TXP.Utils.Texture.CreateNumbers(t,e,a,function(t){0==t.data[0]&&3==t.data[1]&&145==t.data[2]?console.log("looks good from imgData side"):console.log("ERROR ON TEXTURE TEST!!!!!")})},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),t.maxGematria=0,t.minGematria=1640;for(var e=0;e<GEMATRIA_HILIGHT.allWords.length;e++){var n=TXP.Utils.Gematria.CountHebArray(GEMATRIA_HILIGHT.allWords[e]);n>t.maxGematria&&(t.maxGematria=n),n<t.minGematria&&(t.minGematria=n)}TXP.Init(window.innerWidth,GEMATRIA_HILIGHT.GetTextureHeight(window.innerWidth),GEMATRIA_HILIGHT.configOptions.bgColor),gematriaTexture=GEMATRIA_HILIGHT.GetGematriaTexture(TXP.canvasWidth,TXP.canvasHeight),console.log("Created Texture "+gematriaTexture.width+"x"+gematriaTexture.height),t.sprite=new PIXI.Sprite(gematriaTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new TXP.Shaders.MatchValueFilter,t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),GEMATRIA_HILIGHT.Animation.Start(),GEMATRIA_HILIGHT.Controls.Start()}return t.Start=function(n){t.configOptions=n;var a=2;TXP.TanachData.Books.Load({onComplete:function(){--a||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","value-match"]},{onComplete:function(){--a||e()}})},t}(GEMATRIA_HILIGHT||{}),LETTERS_PALETTE=function(t){function e(){return.1*Math.random()}function n(){for(o=t.filter,l=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,i=0;i<l;i++)s[i]={r:e(),g:e(),b:e()};r=new PIXI.ticker.Ticker,r.add(a),r.start()}function a(t){if(!u){var n=o.rPalette,a=o.gPalette,r=o.bPalette;for(i=0;i<l;i++){var T=n[i],c=a[i],d=r[i];T+=t*s[i].r,c+=t*s[i].g,d+=t*s[i].b,T>1?(T=1,s[i].r=e()*-1):T<.01&&(T=.01,s[i].r=e()),c>1?(c=1,s[i].g=e()*-1):c<.01&&(c=.01,s[i].g=e()),d>1?(d=1,s[i].b=e()*-1):d<.01&&(d=.01,s[i].b=e()),n[i]=T,a[i]=c,r[i]=d}}}var o,r,l,s=[],u=!1;return t.Animation={Start:n,TogglePause:function(){u=!u}},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){r>27?r=0:r<0&&(r=27),console.log("CHOSEN LETTER: "+TXP.Utils.TextSubstitution.TEXT_HEBREW[r]);for(var t=0;t<o;t++)0==r||t==r?a.aPalette[t]=1:a.aPalette[t]=0}function n(){a=t.filter,o=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,window.addEventListener("keydown",function(n){var o=n.keyCode;switch(console.log(o),o){case 32:LETTERS_PALETTE.Animation.TogglePause();break;case 38:r++,e();break;case 40:r--,e();break;case 49:a.substitution=0;break;case 50:a.substitution=1;break;case 51:a.substitution=2;break;case 70:t.sprite.scale.x*=-1}}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,n){var a=n.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(a.x=t.sprite.width-a.x);var o=(a.y-1)*t.sprite.width+a.x,r=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+a.x+","+a.y+" offset: "+o);var n=r[o];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[n.book],msg+="\nVerse "+n.pasuk,msg+="\nWord "+n.word,msg+="\nLetter "+n.letter,alert(msg)})}var a,o,r=0;return t.Input={Start:n},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){var e=function(t,e){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("letters-palette"),{rPalette:{value:t.rPalette},gPalette:{value:t.gPalette},bPalette:{value:t.bPalette},aPalette:{value:t.aPalette},substitution:{value:e}})};return e.prototype=Object.create(PIXI.Filter.prototype),e.prototype.constructor=e,Object.defineProperties(e.prototype,{rPalette:{get:function(){return this.uniforms.rPalette},set:function(t){this.uniforms.rPalette=t}},gPalette:{get:function(){return this.uniforms.gPalette},set:function(t){this.uniforms.gPalette=t}},bPalette:{get:function(){return this.uniforms.bPalette},set:function(t){this.uniforms.bPalette=t}},aPalette:{get:function(){return this.uniforms.aPalette},set:function(t){this.uniforms.aPalette=t}},substitution:{get:function(){return this.uniforms.substitution},set:function(t){this.uniforms.substitution=t}}}),t.LettersFilter=e,t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(e){return Math.ceil(t.allLetters.length/e)}return t.GetTextureHeight=e,t.GetLettersTexture=function(n){var a=t.allLetters,o=e(n),r=document.createElement("canvas");r.width=n,r.height=o;for(var i=function(){return void 0==r.getContext?G_vmlCanvasManager.initElement(r).getContext("2d"):r.getContext("2d")}(),l=i.createImageData(r.width,r.height),s=0,u=0;s<a.length;s++){var T=a[s],c=TXP.Utils.TextSubstitution.SUBSTITUTION_ATBASH[T],d=TXP.Utils.TextSubstitution.SUBSTITUTION_ALBAM[T];l.data[u++]=T,l.data[u++]=c,l.data[u++]=d,l.data[u++]=255}return i.putImageData(l,0,0),PIXI.Texture.fromCanvas(r)},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),TXP.Init(window.innerWidth,LETTERS_PALETTE.GetTextureHeight(window.innerWidth),LETTERS_PALETTE.configOptions.bgColor),lettersTexture=LETTERS_PALETTE.GetLettersTexture(TXP.canvasWidth),console.log("Created Texture "+lettersTexture.width+"x"+lettersTexture.height);var e=n();t.sprite=new PIXI.Sprite(lettersTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new LETTERS_PALETTE.LettersFilter(e,0),t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),LETTERS_PALETTE.Animation.Start(),LETTERS_PALETTE.Input.Start()}function n(){for(var t=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,e=[],n=[],a=[],o=[],r=0;r<t;r++)e[r]=Math.random(),n[r]=Math.random(),a[r]=Math.random(),o[r]=1;return{rPalette:e,gPalette:n,bPalette:a,aPalette:o}}return t.Start=function(n){t.configOptions=n;var a=2;TXP.TanachData.Books.Load({onComplete:function(){--a||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","letters-palette"]},{onComplete:function(){--a||e()}})},t}(LETTERS_PALETTE||{}),RATIO_DRAW=function(t){function e(t,e){var n=document.createElement("canvas");n.width=TXP.canvasWidth,n.height=TXP.canvasHeight;for(var a=function(){return void 0==n.getContext?G_vmlCanvasManager.initElement(n).getContext("2d"):n.getContext("2d")}(),o=a.createImageData(n.width,n.height),r=0,i=0;i<t.length;i++)t[i]>r&&(r=t[i]);for(var l=16777215,s=0,i=0;i<o.data.length;i+=4){s>t.length&&(s=0);var u=t[s++];if(1==e.method){var T=u/r,c=T*l,d=Math.floor(c/65536),m=Math.floor(c/256)%256,f=c%256;o.data[i+0]=d,o.data[i+1]=m,o.data[i+2]=f,o.data[i+3]=255}}return a.putImageData(o,0,0),PIXI.Texture.fromCanvas(n)}var n=function(t){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("ratio"),{gSampler:{type:"sampler2D",value:t}})};return n.prototype=Object.create(PIXI.Filter.prototype),n.prototype.constructor=n,Object.defineProperties(n.prototype,{gTexture:{get:function(){return this.uniforms.gSampler},set:function(t){console.log("Changed in filter!"),this.uniforms.gSampler=t}}}),t.DrawGematriaImage=function(t){var a=e(t,{method:1}),o=new PIXI.Graphics;o.beginFill(16777215),o.drawRect(0,0,a.width,a.height),o.endFill();var r=new n(a);o.filters=[r],TXP.stage.addChild(o)},t}(RATIO_DRAW||{}),RATIO_DRAW=function(t){function e(){var t=TXP.TanachData.SeparateBooks.GetFlattened({benchMark:!0,gematriaPerLetter:!0});RATIO_DRAW.DrawGematriaImage(t)}return t.Start=function(n){t.configOptions=n,TXP.Init(window.innerWidth,window.innerHeight,n.bgColor);var a=2;TXP.TanachData.SeparateBooks.Load({onComplete:function(){--a||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","ratio"]},{onComplete:function(){--a||e()}})},t}(RATIO_DRAW||{}),AudioInstrument=function(t){function e(t,e,n,a,o,r){var i=(t-e)/(n-e),l=i*(o-a)+a;return r===!0&&console.log(t,i,l),l}function n(){null!=s&&s.stop(),null!=T&&(clearInterval(T),T=null),l=null,s=null,u=null,i.innerHTML=""}function a(){statusText="CurrentTime: "+l.currentTime+"<br/>Total duration: "+r,i.innerHTML=statusText,l.currentTime>r&&n()}function o(t){var o=2;n(),l=new(window.AudioContext||window.webkitAudioContext),u=l.createBuffer(o,t.vals.length,l.sampleRate),s=l.createBufferSource(),r=t.vals.length/l.sampleRate;for(var i=[],c=0;c<t.vals.length;c++){var d=t.vals[c];i.push(e(d,t.minVal,t.maxVal,-1,1))}for(var m=0;m<o;m++)for(var f=u.getChannelData(m),c=0;c<i.length;c++)f[c]=i[c];s.buffer=u,s.connect(l.destination),s.start(),T=setInterval(a,1e3/l.sampleRate)}var r,i,l=null,s=null,u=null,T=null;return t.StopAudio=n,t.PlayAudio=o,t.Setup=function(){i=document.getElementById("status")},t}(AudioInstrument||{}),SOUND_BUFFER=function(t){function e(){i(TXP.TanachData.Books.GetAllWords())}function n(){i(TXP.TanachData.Books.GetAllLetters())}function a(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],n=0;n<t.length;n++){for(var a=t[n],o=0;o<a.length;o++)e.push(a[o]);e.push(0)}i(e)}function o(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],n=0;n<t.length;n++)e.push(TXP.Utils.TextSubstitution.GetMilui(t[n]));i(e)}function r(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],n=0;n<t.length;n++)for(var a=TXP.Utils.TextSubstitution.GetMilui(t[n]),o=0;o<a.length;o++)e.push(a[o]);i(e)}function i(t){for(var e=-1,n=-1,a=[],o=0;o<t.length;o++){var r;r=s?TXP.Utils.Gematria.CountData(t[o]):TXP.Utils.Gematria.CountData(t[o],{skipGematria:!0}),a.push(r),(e==-1||r>e)&&(e=r),(n==-1||r<n)&&(n=r)}AudioInstrument.PlayAudio({maxVal:e,minVal:n,vals:a})}function l(){$("#gematriaMode").on("click",function(){s=!s,s?$("#gematriaMode").addClass("selected"):$("#gematriaMode").removeClass("selected"),AudioInstrument.StopAudio()}),AudioInstrument.Setup();var t=document.getElementById("playLetters");t.onclick=n;var t=document.getElementById("playWords");t.onclick=e;var t=document.getElementById("playMiluiWords");t.onclick=o;var t=document.getElementById("playMiluiLetters");t.onclick=r;var t=document.getElementById("playLettersBreaks");t.onclick=a;var t=document.getElementById("stop");t.onclick=AudioInstrument.StopAudio}var s=!1;return t.Start=function(e){t.configOptions=e;var n=1;TXP.TanachData.Books.Load({onComplete:function(){--n||l()}})},t}(SOUND_BUFFER||{}),AudioInstrument=function(t){function e(t,e,n,a,o,r){var i=(t-e)/(n-e),l=i*(o-a)+a;return r===!0&&console.log(t,i,l),l}function n(){$("#playNextSound").hide(),null!=d&&(clearInterval(d),d=null),T.innerHTML=""}function a(){if(s>l.length)n();else{currentTiming=(new Date).getTime()-c;var t=l[s];t.timing<currentTiming&&(r(t),s++)}}function o(){s<l.length&&(r(l[s]),s++)}function r(t){var e="";e+="Current index: "+s,e+="<br/>",e+=t.text,T.innerHTML=e,u.play(t.note,t.octave,t.duration)}function i(t){n(),l=[];for(var o=0,r=0;r<t.vals.length;r++){var i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],u=t.vals[r].num,T=t.vals[r].text,m=i[Math.round(e(u,t.minVal,t.maxVal,0,i.length-1))],f=Math.round(e(u,t.minVal,t.maxVal,1,4)),g=3*Math.random();o+=1e3*Math.random(),musicInfo={val:u,text:T,note:m,octave:f,duration:g,timing:o},l.push(musicInfo)}s=0,c=(new Date).getTime(),t.autoPlayMode===!0?(d=setInterval(a,1e3/44100),$("#playNextSound").hide()):$("#playNextSound").show()}var l,s,u,T,c,d=null;return t.StopAudio=n,t.PlayAudio=i,t.PlayNextSound=o,t.Setup=function(){T=document.getElementById("status"),u=Synth.createInstrument("piano")},t}(AudioInstrument||{}),SOUND_INSTRUMENT=function(t){function e(){i(TXP.TanachData.Books.GetAllWords())}function n(){i(TXP.TanachData.Books.GetAllLetters())}function a(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],n=0;n<t.length;n++){for(var a=t[n],o=0;o<a.length;o++)e.push(a[o]);e.push(0)}i(e)}function o(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],n=0;n<t.length;n++)e.push(TXP.Utils.TextSubstitution.GetMilui(t[n]));i(e)}function r(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],n=0;n<t.length;n++)for(var a=TXP.Utils.TextSubstitution.GetMilui(t[n]),o=0;o<a.length;o++)e.push(a[o]);i(e)}function i(t){for(var e=-1,n=-1,a=[],o=0;o<t.length;o++){var r={};s?r.num=TXP.Utils.Gematria.CountData(t[o]):r.num=TXP.Utils.Gematria.CountData(t[o],{skipGematria:!0}),o<3&&(console.log(t[o]),console.log(TXP.Utils.TextSubstitution.GetText(t[o]))),r.text=TXP.Utils.TextSubstitution.GetText(t[o]),a.push(r),(e==-1||r.num>e)&&(e=r.num),(n==-1||r.num<n)&&(n=r.num)}AudioInstrument.PlayAudio({maxVal:e,minVal:n,vals:a,autoPlayMode:u})}function l(){$("#gematriaMode").on("click",function(){s=!s,s?$("#gematriaMode").addClass("selected"):$("#gematriaMode").removeClass("selected"),AudioInstrument.StopAudio()}),$("#autoPlayMode").on("click",function(){u=!u,u?$("#autoPlayMode").addClass("selected"):$("#autoPlayMode").removeClass("selected"),AudioInstrument.StopAudio()}),$("#playNextSound").on("click",function(){u||AudioInstrument.PlayNextSound()}),$("#playNextSound").hide(),AudioInstrument.Setup();var t=document.getElementById("playLetters");t.onclick=n;var t=document.getElementById("playWords");t.onclick=e;var t=document.getElementById("playMiluiWords");t.onclick=o;var t=document.getElementById("playMiluiLetters");t.onclick=r;var t=document.getElementById("playLettersBreaks");t.onclick=a;var t=document.getElementById("stop");t.onclick=AudioInstrument.StopAudio}var s=!1,u=!0;return t.Start=function(e){t.configOptions=e;var n=1;TXP.TanachData.Books.Load({onComplete:function(){--n||l()}})},t}(SOUND_INSTRUMENT||{}),TESTS=function(t){var e=304801,n=1196838;return t.BookTest=function(){for(var t=0,a=5,o=TXP.TanachData.Books.GetData(),r=0;r<5;r++)for(var i=o[r],l=0;l<i.length;l++)for(var s=i[l],u=0;u<s.length;u++)for(var T=s[u],c=0;c<T.length;c++){T[c];t++}t!=e?alert("CHUMASH BOOK TEST FAILED!"):console.log("CHUMASH BOOK TEST PASSED!"),t=0,a=o.length;for(var r=0;r<a;r++)for(var i=o[r],l=0;l<i.length;l++)for(var s=i[l],u=0;u<s.length;u++)for(var T=s[u],c=0;c<T.length;c++){T[c];t++}t!=n?alert("TANACH BOOK TEST FAILED!"):console.log("TANACH BOOK TEST PASSED!")},t.SeparateBookTest=function(){for(var t=TXP.TanachData.SeparateBooks.names,a=0,o=5,r=0;r<o;r++)for(var i=t[r],l=TXP.TanachData.SeparateBooks.GetData(i),s=0;s<l.length;s++)for(var u=l[s],T=0;T<u.length;T++)for(var c=u[T],d=0;d<c.length;d++){c[d];a++}a!=e?alert("CHUMASH BOOK TEST FAILED!"):console.log("CHUMASH BOOK TEST PASSED!"),a=0,o=t.length;for(var r=0;r<o;r++)for(var i=t[r],l=TXP.TanachData.SeparateBooks.GetData(i),s=0;s<l.length;s++)for(var u=l[s],T=0;T<u.length;T++)for(var c=u[T],d=0;d<c.length;d++){c[d];a++}a!=n?alert("TANACH BOOK TEST FAILED!"):console.log("TANACH BOOK TEST PASSED!")},t.LettersTest=function(){var t=TXP.TanachData.Letters.GetData().length;t!=n?alert("TANACH LETTERS TEST FAILED! "+t):console.log("TANACH LETTERS TEST PASSED!")},t}(TESTS||{}),WORD_HILIGHT=function(t){function e(){r=t.filter,a(.5),l=0,n(l),i=new PIXI.ticker.Ticker,i.add(o),i.start()}function n(t){WORD_HILIGHT.Controls.SetWord(TXP.Utils.TextSubstitution.GetTextFromArray(WORD_HILIGHT.allWords[t]))}function a(t){s=d-t*d}function o(t){T||(c+=t,c>s&&(c=0,u?--l<0&&(l=WORD_HILIGHT.allWords.length-1):++l>WORD_HILIGHT.allWords.length&&(l=0),n(l)))}var r,i,l,s,u=!1,T=!1,c=0,d=50;return t.Animation={Start:e,SetSpeed:a,IsPaused:function(){return T},TogglePause:function(){T=!T},ToggleRewind:function(){u=!u},IsRewind:function(){return u}},t}(WORD_HILIGHT||{}),WORD_HILIGHT=function(t){function e(e){t.wordLookup.hasOwnProperty(e)&&(t.filter.numberValue=t.wordLookup[e],$("#wordval").val(e))}function n(){t.filter.bgColor=parseInt($("#bgColor").spectrum("get").toHex(),16),t.filter.matchColor=parseInt($("#matchColor").spectrum("get").toHex(),16)}function a(){n(),$("#bgColor").on("move.spectrum",n),$("#matchColor").on("move.spectrum",n),$("#bgColor").on("change.spectrum",n),$("#matchColor").on("change.spectrum",n),window.addEventListener("keydown",function(e){var n=e.keyCode;switch(n){case 70:t.sprite.scale.x*=-1}}),$("#speed").on("input",function(){WORD_HILIGHT.Animation.SetSpeed($("#speed").val()/100)}),$("#playMode").on("click",function(){WORD_HILIGHT.Animation.TogglePause(),$("#playMode").val(WORD_HILIGHT.Animation.IsPaused()?"Play":"Pause")}),$("#rewindMode").on("click",function(){WORD_HILIGHT.Animation.ToggleRewind(),WORD_HILIGHT.Animation.IsRewind()?$("#rewindMode").addClass("selected"):$("#rewindMode").removeClass("selected")}),$("#wordval").on("input",function(){var n=$("#wordval").val();t.wordLookup.hasOwnProperty(n)&&e(n)}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,n){var a=n.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(a.x=t.sprite.width-a.x);var o=(a.y-1)*t.sprite.width+a.x,r=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+a.x+","+a.y+" offset: "+o);var n=r[o];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[n.book],msg+="\nVerse "+n.pasuk,msg+="\nWord "+n.word,msg+="\nLetter "+n.letter,alert(msg)})}return t.Controls={SetWord:e,Start:a,ResetColors:n},t}(WORD_HILIGHT||{}),WORD_HILIGHT=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),TXP.Init(window.innerWidth,WORD_HILIGHT.GetTextureHeight(window.innerWidth),WORD_HILIGHT.configOptions.bgColor),wordsTexture=WORD_HILIGHT.GetWordsTexture(TXP.canvasWidth,TXP.canvasHeight),t.sprite=new PIXI.Sprite(wordsTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new TXP.Shaders.MatchValueFilter,t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),WORD_HILIGHT.Animation.Start(),WORD_HILIGHT.Controls.Start()}return t.Start=function(n){t.configOptions=n;var a=2;TXP.TanachData.Books.Load({onComplete:function(){--a||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","value-match"]},{onComplete:function(){--a||e()}})},t}(WORD_HILIGHT||{}),WORD_HILIGHT=function(t){function e(t){return Math.ceil(WORD_HILIGHT.allLetters.length/t)}return t.GetTextureHeight=e,t.GetWordsTexture=function(e,n){for(var a,o=0,r=0,i={},l=0,s=[];o<WORD_HILIGHT.allWords.length&&r<WORD_HILIGHT.allWords[o].length;){var u=WORD_HILIGHT.allWords[o];0==r&&(a=TXP.Utils.TextSubstitution.GetTextFromArray(u),i.hasOwnProperty(a)||(i[a]=l++)),s.push(i[a]),++r==u.length&&(o++,r=0)}return t.wordLookup=i,TXP.Utils.Texture.CreateNumbers(e,n,s,function(t){var e=WORD_HILIGHT.allWords[4],n=i[TXP.Utils.TextSubstitution.GetTextFromArray(e)],a=WORD_HILIGHT.allWords[0].concat(WORD_HILIGHT.allWords[1]).concat(WORD_HILIGHT.allWords[2]).concat(WORD_HILIGHT.allWords[3]).length;a*=4,4==n&&"השמים"==TXP.Utils.TextSubstitution.GetTextFromArray(e)||console.log("WRONG TEST WORD INDEX!"),(n>>16&255)==t.data[a]&&(n>>8&255)==t.data[a+1]&&(255&n)==t.data[a+2]?console.log("looks good from imgData side"):console.log("ERROR ON TEXTURE TEST!!!!!")})},t}(WORD_HILIGHT||{});