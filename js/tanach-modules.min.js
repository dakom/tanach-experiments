var GEMATRIA_HILIGHT=function(t){function e(){o=t.filter,a(.5),i=t.minGematria,GEMATRIA_HILIGHT.Controls.SetGematria(t.minGematria),r=new PIXI.ticker.Ticker,r.add(n),r.start()}function a(t){l=c-t*c}function n(e){u||(T+=e,T>l&&(T=0,s?--i<t.minGematria&&(i=t.maxGematria):++i>t.maxGematria&&(i=t.minGematria),GEMATRIA_HILIGHT.Controls.SetGematria(i)))}var o,r,i,l,s=!1,u=!1,T=0,c=50;return t.Animation={Start:e,SetSpeed:a,IsPaused:function(){return u},TogglePause:function(){u=!u},ToggleRewind:function(){s=!s},IsRewind:function(){return s}},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(e){t.filter.numberValue=e,$("#gemval").val(e)}function a(){t.filter.bgColor=parseInt($("#bgColor").spectrum("get").toHex(),16),t.filter.matchColor=parseInt($("#matchColor").spectrum("get").toHex(),16)}function n(){a(),$("#bgColor").on("move.spectrum",a),$("#matchColor").on("move.spectrum",a),$("#bgColor").on("change.spectrum",a),$("#matchColor").on("change.spectrum",a),window.addEventListener("keydown",function(e){var a=e.keyCode;switch(a){case 70:t.sprite.scale.x*=-1}}),$("#speed").on("input",function(){GEMATRIA_HILIGHT.Animation.SetSpeed($("#speed").val()/100)}),$("#rewindMode").on("click",function(){GEMATRIA_HILIGHT.Animation.ToggleRewind(),GEMATRIA_HILIGHT.Animation.IsRewind()?$("#rewindMode").addClass("selected"):$("#rewindMode").removeClass("selected")}),$("#playMode").on("click",function(){GEMATRIA_HILIGHT.Animation.TogglePause(),$("#playMode").val(GEMATRIA_HILIGHT.Animation.IsPaused()?"Play":"Pause")}),$("#gemval").on("input",function(){var a=$("#gemval").val();a>=t.minGematria&&a<=t.maxGematria&&e(a)}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,a){var n=a.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(n.x=t.sprite.width-n.x);var o=(n.y-1)*t.sprite.width+n.x,r=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+n.x+","+n.y+" offset: "+o);var a=r[o];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[a.book],msg+="\nVerse "+a.pasuk,msg+="\nWord "+a.word,msg+="\nLetter "+a.letter,alert(msg)})}return t.Controls={SetGematria:e,Start:n,ResetColors:a},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(t){return Math.ceil(GEMATRIA_HILIGHT.allLetters.length/t)}return t.GetTextureHeight=e,t.GetGematriaTexture=function(t,e){for(var a,n=[],o=0,r=0;o<GEMATRIA_HILIGHT.allWords.length&&r<GEMATRIA_HILIGHT.allWords[o].length;){var i=GEMATRIA_HILIGHT.allWords[o];0==r&&(a=TXP.Utils.Gematria.CountHebArray(i)),n.push(a),++r==i.length&&(o++,r=0)}return TXP.Utils.Texture.CreateNumbers(t,e,n,function(t){0==t.data[0]&&3==t.data[1]&&145==t.data[2]?console.log("looks good from imgData side"):console.log("ERROR ON TEXTURE TEST!!!!!")})},t}(GEMATRIA_HILIGHT||{}),GEMATRIA_HILIGHT=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),t.maxGematria=0,t.minGematria=1640;for(var e=0;e<GEMATRIA_HILIGHT.allWords.length;e++){var a=TXP.Utils.Gematria.CountHebArray(GEMATRIA_HILIGHT.allWords[e]);a>t.maxGematria&&(t.maxGematria=a),a<t.minGematria&&(t.minGematria=a)}TXP.Init(window.innerWidth,GEMATRIA_HILIGHT.GetTextureHeight(window.innerWidth),GEMATRIA_HILIGHT.configOptions.bgColor),gematriaTexture=GEMATRIA_HILIGHT.GetGematriaTexture(TXP.canvasWidth,TXP.canvasHeight),console.log("Created Texture "+gematriaTexture.width+"x"+gematriaTexture.height),t.sprite=new PIXI.Sprite(gematriaTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new TXP.Shaders.MatchValueFilter,t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),GEMATRIA_HILIGHT.Animation.Start(),GEMATRIA_HILIGHT.Controls.Start()}return t.Start=function(a){t.configOptions=a;var n=2;TXP.TanachData.Books.Load({onComplete:function(){--n||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","value-match"]},{onComplete:function(){--n||e()}})},t}(GEMATRIA_HILIGHT||{}),LETTERS_PALETTE=function(t){function e(){return.1*Math.random()}function a(){for(o=t.filter,l=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,i=0;i<l;i++)s[i]={r:e(),g:e(),b:e()};r=new PIXI.ticker.Ticker,r.add(n),r.start()}function n(t){if(!u){var a=o.rPalette,n=o.gPalette,r=o.bPalette;for(i=0;i<l;i++){var T=a[i],c=n[i],d=r[i];T+=t*s[i].r,c+=t*s[i].g,d+=t*s[i].b,T>1?(T=1,s[i].r=e()*-1):T<.01&&(T=.01,s[i].r=e()),c>1?(c=1,s[i].g=e()*-1):c<.01&&(c=.01,s[i].g=e()),d>1?(d=1,s[i].b=e()*-1):d<.01&&(d=.01,s[i].b=e()),a[i]=T,n[i]=c,r[i]=d}}}var o,r,l,s=[],u=!1;return t.Animation={Start:a,TogglePause:function(){u=!u}},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){r>27?r=0:r<0&&(r=27),console.log("CHOSEN LETTER: "+TXP.Utils.TextSubstitution.TEXT_HEBREW[r]);for(var t=0;t<o;t++)0==r||t==r?n.aPalette[t]=1:n.aPalette[t]=0}function a(){n=t.filter,o=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,window.addEventListener("keydown",function(a){var o=a.keyCode;switch(console.log(o),o){case 32:LETTERS_PALETTE.Animation.TogglePause();break;case 38:r++,e();break;case 40:r--,e();break;case 49:n.substitution=0;break;case 50:n.substitution=1;break;case 51:n.substitution=2;break;case 70:t.sprite.scale.x*=-1}}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,a){var n=a.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(n.x=t.sprite.width-n.x);var o=(n.y-1)*t.sprite.width+n.x,r=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+n.x+","+n.y+" offset: "+o);var a=r[o];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[a.book],msg+="\nVerse "+a.pasuk,msg+="\nWord "+a.word,msg+="\nLetter "+a.letter,alert(msg)})}var n,o,r=0;return t.Input={Start:a},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){var e=function(t,e){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("letters-palette"),{rPalette:{value:t.rPalette},gPalette:{value:t.gPalette},bPalette:{value:t.bPalette},aPalette:{value:t.aPalette},substitution:{value:e}})};return e.prototype=Object.create(PIXI.Filter.prototype),e.prototype.constructor=e,Object.defineProperties(e.prototype,{rPalette:{get:function(){return this.uniforms.rPalette},set:function(t){this.uniforms.rPalette=t}},gPalette:{get:function(){return this.uniforms.gPalette},set:function(t){this.uniforms.gPalette=t}},bPalette:{get:function(){return this.uniforms.bPalette},set:function(t){this.uniforms.bPalette=t}},aPalette:{get:function(){return this.uniforms.aPalette},set:function(t){this.uniforms.aPalette=t}},substitution:{get:function(){return this.uniforms.substitution},set:function(t){this.uniforms.substitution=t}}}),t.LettersFilter=e,t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(e){return Math.ceil(t.allLetters.length/e)}return t.GetTextureHeight=e,t.GetLettersTexture=function(a){var n=t.allLetters,o=e(a),r=document.createElement("canvas");r.width=a,r.height=o;for(var i=function(){return void 0==r.getContext?G_vmlCanvasManager.initElement(r).getContext("2d"):r.getContext("2d")}(),l=i.createImageData(r.width,r.height),s=0,u=0;s<n.length;s++){var T=n[s],c=TXP.Utils.TextSubstitution.SUBSTITUTION_ATBASH[T],d=TXP.Utils.TextSubstitution.SUBSTITUTION_ALBAM[T];l.data[u++]=T,l.data[u++]=c,l.data[u++]=d,l.data[u++]=255}return i.putImageData(l,0,0),PIXI.Texture.fromCanvas(r)},t}(LETTERS_PALETTE||{}),LETTERS_PALETTE=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),TXP.Init(window.innerWidth,LETTERS_PALETTE.GetTextureHeight(window.innerWidth),LETTERS_PALETTE.configOptions.bgColor),lettersTexture=LETTERS_PALETTE.GetLettersTexture(TXP.canvasWidth),console.log("Created Texture "+lettersTexture.width+"x"+lettersTexture.height);var e=a();t.sprite=new PIXI.Sprite(lettersTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new LETTERS_PALETTE.LettersFilter(e,0),t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),LETTERS_PALETTE.Animation.Start(),LETTERS_PALETTE.Input.Start()}function a(){for(var t=TXP.Utils.TextSubstitution.TEXT_HEBREW.length,e=[],a=[],n=[],o=[],r=0;r<t;r++)e[r]=Math.random(),a[r]=Math.random(),n[r]=Math.random(),o[r]=1;return{rPalette:e,gPalette:a,bPalette:n,aPalette:o}}return t.Start=function(a){t.configOptions=a;var n=2;TXP.TanachData.Books.Load({onComplete:function(){--n||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","letters-palette"]},{onComplete:function(){--n||e()}})},t}(LETTERS_PALETTE||{}),RATIO_DRAW=function(t){function e(t,e){var a=document.createElement("canvas");a.width=TXP.canvasWidth,a.height=TXP.canvasHeight;for(var n=function(){return void 0==a.getContext?G_vmlCanvasManager.initElement(a).getContext("2d"):a.getContext("2d")}(),o=n.createImageData(a.width,a.height),r=0,i=0;i<t.length;i++)t[i]>r&&(r=t[i]);for(var l=16777215,s=0,i=0;i<o.data.length;i+=4){s>t.length&&(s=0);var u=t[s++];if(1==e.method){var T=u/r,c=T*l,d=Math.floor(c/65536),m=Math.floor(c/256)%256,f=c%256;o.data[i+0]=d,o.data[i+1]=m,o.data[i+2]=f,o.data[i+3]=255}}return n.putImageData(o,0,0),PIXI.Texture.fromCanvas(a)}var a=function(t){PIXI.Filter.call(this,TXP.Shaders.GetVertexCode("default"),TXP.Shaders.GetFragmentCode("ratio"),{gSampler:{type:"sampler2D",value:t}})};return a.prototype=Object.create(PIXI.Filter.prototype),a.prototype.constructor=a,Object.defineProperties(a.prototype,{gTexture:{get:function(){return this.uniforms.gSampler},set:function(t){console.log("Changed in filter!"),this.uniforms.gSampler=t}}}),t.DrawGematriaImage=function(t){var n=e(t,{method:1}),o=new PIXI.Graphics;o.beginFill(16777215),o.drawRect(0,0,n.width,n.height),o.endFill();var r=new a(n);o.filters=[r],TXP.stage.addChild(o)},t}(RATIO_DRAW||{}),RATIO_DRAW=function(t){function e(){var t=TXP.TanachData.SeparateBooks.GetFlattened({benchMark:!0,gematriaPerLetter:!0});RATIO_DRAW.DrawGematriaImage(t)}return t.Start=function(a){t.configOptions=a,TXP.Init(window.innerWidth,window.innerHeight,a.bgColor);var n=2;TXP.TanachData.SeparateBooks.Load({onComplete:function(){--n||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","ratio"]},{onComplete:function(){--n||e()}})},t}(RATIO_DRAW||{}),RawAudioInstrument=function(t){function e(t,e,a,n,o,r){var i=(t-e)/(a-e),l=i*(o-n)+n;return r===!0&&console.log(t,i,l),l}function a(){null!=s&&s.stop(),null!=T&&(clearInterval(T),T=null),l=null,s=null,u=null,i.innerHTML=""}function n(){statusText="CurrentTime: "+l.currentTime+"<br/>Total duration: "+r,i.innerHTML=statusText,l.currentTime>r&&a()}function o(t){var o=2;a(),l=new(window.AudioContext||window.webkitAudioContext),u=l.createBuffer(o,t.vals.length,l.sampleRate),s=l.createBufferSource(),r=t.vals.length/l.sampleRate;for(var i=[],c=0;c<t.vals.length;c++){var d=t.vals[c];i.push(e(d,t.minVal,t.maxVal,-1,1))}for(var m=0;m<o;m++)for(var f=u.getChannelData(m),c=0;c<i.length;c++)f[c]=i[c];s.buffer=u,s.connect(l.destination),s.start(),T=setInterval(n,1e3/l.sampleRate)}var r,i,l=null,s=null,u=null,T=null;return t.StopAudio=a,t.PlayAudio=o,t.Setup=function(){i=document.getElementById("status")},t}(RawAudioInstrument||{}),SOUND_BUFFER=function(t){function e(){i(TXP.TanachData.Books.GetAllWords())}function a(){i(TXP.TanachData.Books.GetAllLetters())}function n(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],a=0;a<t.length;a++){for(var n=t[a],o=0;o<n.length;o++)e.push(n[o]);e.push(0)}i(e)}function o(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],a=0;a<t.length;a++)e.push(TXP.Utils.TextSubstitution.GetMilui(t[a]));i(e)}function r(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],a=0;a<t.length;a++)for(var n=TXP.Utils.TextSubstitution.GetMilui(t[a]),o=0;o<n.length;o++)e.push(n[o]);i(e)}function i(t){for(var e=-1,a=-1,n=[],o=0;o<t.length;o++){var r;r=s?TXP.Utils.Gematria.CountData(t[o]):TXP.Utils.Gematria.CountData(t[o],{skipGematria:!0}),n.push(r),(e==-1||r>e)&&(e=r),(a==-1||r<a)&&(a=r)}RawAudioInstrument.PlayAudio({maxVal:e,minVal:a,vals:n})}function l(){$("#gematriaMode").on("click",function(){s=!s,s?$("#gematriaMode").addClass("selected"):$("#gematriaMode").removeClass("selected"),RawAudioInstrument.StopAudio()}),RawAudioInstrument.Setup();var t=document.getElementById("playLetters");t.onclick=a;var t=document.getElementById("playWords");t.onclick=e;var t=document.getElementById("playMiluiWords");t.onclick=o;var t=document.getElementById("playMiluiLetters");t.onclick=r;var t=document.getElementById("playLettersBreaks");t.onclick=n;var t=document.getElementById("stop");t.onclick=RawAudioInstrument.StopAudio}var s=!1;return t.Start=function(e){t.configOptions=e;var a=1;TXP.TanachData.Books.Load({onComplete:function(){--a||l()}})},t}(SOUND_BUFFER||{}),NaturalAudioInstrument=function(t){function e(t,e,a,n,o,r){var i=(t-e)/(a-e),l=i*(o-n)+n;return r===!0&&console.log(t,i,l),l}function a(){$("#playNextSound").hide(),null!=d&&(clearInterval(d),d=null),T.innerHTML=""}function n(){if(s>l.length)a();else{currentTiming=(new Date).getTime()-c;var t=l[s];t.timing<currentTiming&&(r(t),s++)}}function o(){s<l.length&&(r(l[s]),s++)}function r(t){var e="";e+="Current index: "+s,e+="<br/>",e+=t.text,T.innerHTML=e,u.play(t.note,t.octave,t.duration)}function i(t){a(),l=[];for(var o=0,r=0;r<t.vals.length;r++){var i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],u=t.vals[r].num,T=t.vals[r].text,m=i[Math.round(e(u,t.minVal,t.maxVal,0,i.length-1))],f=Math.round(e(u,t.minVal,t.maxVal,1,4)),g=3*Math.random();o+=1e3*Math.random(),musicInfo={val:u,text:T,note:m,octave:f,duration:g,timing:o},l.push(musicInfo)}s=0,c=(new Date).getTime(),t.autoPlayMode===!0?(d=setInterval(n,1e3/44100),$("#playNextSound").hide()):$("#playNextSound").show()}var l,s,u,T,c,d=null;return t.StopAudio=a,t.PlayAudio=i,t.PlayNextSound=o,t.Setup=function(){T=document.getElementById("status"),u=Synth.createInstrument("piano")},t}(NaturalAudioInstrument||{}),SOUND_INSTRUMENT=function(t){function e(){i(TXP.TanachData.Books.GetAllWords())}function a(){i(TXP.TanachData.Books.GetAllLetters())}function n(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],a=0;a<t.length;a++){for(var n=t[a],o=0;o<n.length;o++)e.push(n[o]);e.push(0)}i(e)}function o(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],a=0;a<t.length;a++)e.push(TXP.Utils.TextSubstitution.GetMilui(t[a]));i(e)}function r(){for(var t=TXP.TanachData.Books.GetAllWords(),e=[],a=0;a<t.length;a++)for(var n=TXP.Utils.TextSubstitution.GetMilui(t[a]),o=0;o<n.length;o++)e.push(n[o]);i(e)}function i(t){for(var e=-1,a=-1,n=[],o=0;o<t.length;o++){var r={};s?r.num=TXP.Utils.Gematria.CountData(t[o]):r.num=TXP.Utils.Gematria.CountData(t[o],{skipGematria:!0}),o<3&&(console.log(t[o]),console.log(TXP.Utils.TextSubstitution.GetText(t[o]))),r.text=TXP.Utils.TextSubstitution.GetText(t[o]),n.push(r),(e==-1||r.num>e)&&(e=r.num),(a==-1||r.num<a)&&(a=r.num)}NaturalAudioInstrument.PlayAudio({maxVal:e,minVal:a,vals:n,autoPlayMode:u})}function l(){$("#gematriaMode").on("click",function(){s=!s,s?$("#gematriaMode").addClass("selected"):$("#gematriaMode").removeClass("selected"),NaturalAudioInstrument.StopAudio()}),$("#autoPlayMode").on("click",function(){u=!u,u?$("#autoPlayMode").addClass("selected"):$("#autoPlayMode").removeClass("selected"),NaturalAudioInstrument.StopAudio()}),$("#playNextSound").on("click",function(){u||NaturalAudioInstrument.PlayNextSound()}),$("#playNextSound").hide(),NaturalAudioInstrument.Setup();var t=document.getElementById("playLetters");t.onclick=a;var t=document.getElementById("playWords");t.onclick=e;var t=document.getElementById("playMiluiWords");t.onclick=o;var t=document.getElementById("playMiluiLetters");t.onclick=r;var t=document.getElementById("playLettersBreaks");t.onclick=n;var t=document.getElementById("stop");t.onclick=NaturalAudioInstrument.StopAudio}var s=!1,u=!0;return t.Start=function(e){t.configOptions=e;var a=1;TXP.TanachData.Books.Load({onComplete:function(){--a||l()}})},t}(SOUND_INSTRUMENT||{}),TESTS=function(t){var e=304801,a=1196838;return t.BookTest=function(){for(var t=0,n=5,o=TXP.TanachData.Books.GetData(),r=0;r<5;r++)for(var i=o[r],l=0;l<i.length;l++)for(var s=i[l],u=0;u<s.length;u++)for(var T=s[u],c=0;c<T.length;c++){T[c];t++}t!=e?alert("CHUMASH BOOK TEST FAILED!"):console.log("CHUMASH BOOK TEST PASSED!"),t=0,n=o.length;for(var r=0;r<n;r++)for(var i=o[r],l=0;l<i.length;l++)for(var s=i[l],u=0;u<s.length;u++)for(var T=s[u],c=0;c<T.length;c++){T[c];t++}t!=a?alert("TANACH BOOK TEST FAILED!"):console.log("TANACH BOOK TEST PASSED!")},t.SeparateBookTest=function(){for(var t=TXP.TanachData.SeparateBooks.names,n=0,o=5,r=0;r<o;r++)for(var i=t[r],l=TXP.TanachData.SeparateBooks.GetData(i),s=0;s<l.length;s++)for(var u=l[s],T=0;T<u.length;T++)for(var c=u[T],d=0;d<c.length;d++){c[d];n++}n!=e?alert("CHUMASH BOOK TEST FAILED!"):console.log("CHUMASH BOOK TEST PASSED!"),n=0,o=t.length;for(var r=0;r<o;r++)for(var i=t[r],l=TXP.TanachData.SeparateBooks.GetData(i),s=0;s<l.length;s++)for(var u=l[s],T=0;T<u.length;T++)for(var c=u[T],d=0;d<c.length;d++){c[d];n++}n!=a?alert("TANACH BOOK TEST FAILED!"):console.log("TANACH BOOK TEST PASSED!")},t.LettersTest=function(){var t=TXP.TanachData.Letters.GetData().length;t!=a?alert("TANACH LETTERS TEST FAILED! "+t):console.log("TANACH LETTERS TEST PASSED!")},t}(TESTS||{}),WORD_HILIGHT=function(t){function e(){r=t.filter,n(.5),l=0,a(l),i=new PIXI.ticker.Ticker,i.add(o),i.start()}function a(t){WORD_HILIGHT.Controls.SetWord(TXP.Utils.TextSubstitution.GetTextFromArray(WORD_HILIGHT.allWords[t]))}function n(t){s=d-t*d}function o(t){T||(c+=t,c>s&&(c=0,u?--l<0&&(l=WORD_HILIGHT.allWords.length-1):++l>WORD_HILIGHT.allWords.length&&(l=0),a(l)))}var r,i,l,s,u=!1,T=!1,c=0,d=50;return t.Animation={Start:e,SetSpeed:n,IsPaused:function(){return T},TogglePause:function(){T=!T},ToggleRewind:function(){u=!u},IsRewind:function(){return u}},t}(WORD_HILIGHT||{}),WORD_HILIGHT=function(t){function e(e){t.wordLookup.hasOwnProperty(e)&&(t.filter.numberValue=t.wordLookup[e],$("#wordval").val(e))}function a(){t.filter.bgColor=parseInt($("#bgColor").spectrum("get").toHex(),16),t.filter.matchColor=parseInt($("#matchColor").spectrum("get").toHex(),16)}function n(){a(),$("#bgColor").on("move.spectrum",a),$("#matchColor").on("move.spectrum",a),$("#bgColor").on("change.spectrum",a),$("#matchColor").on("change.spectrum",a),window.addEventListener("keydown",function(e){var a=e.keyCode;switch(a){case 70:t.sprite.scale.x*=-1}}),$("#speed").on("input",function(){WORD_HILIGHT.Animation.SetSpeed($("#speed").val()/100)}),$("#playMode").on("click",function(){WORD_HILIGHT.Animation.TogglePause(),$("#playMode").val(WORD_HILIGHT.Animation.IsPaused()?"Play":"Pause")}),$("#rewindMode").on("click",function(){WORD_HILIGHT.Animation.ToggleRewind(),WORD_HILIGHT.Animation.IsRewind()?$("#rewindMode").addClass("selected"):$("#rewindMode").removeClass("selected")}),$("#wordval").on("input",function(){var a=$("#wordval").val();t.wordLookup.hasOwnProperty(a)&&e(a)}),t.sprite.interactive=!0,TXP.Interactions.TouchEvent.addTouchStartListener(t.sprite,function(e,a){var n=a.data.getLocalPosition(e.parent);t.sprite.scale.x==-1&&(n.x=t.sprite.width-n.x);var o=(n.y-1)*t.sprite.width+n.x,r=TXP.TanachData.Books.GetLetterInfos();console.log("point: "+n.x+","+n.y+" offset: "+o);var a=r[o];msg="",msg+=TXP.TanachData.SeparateBooks.niceNames[a.book],msg+="\nVerse "+a.pasuk,msg+="\nWord "+a.word,msg+="\nLetter "+a.letter,alert(msg)})}return t.Controls={SetWord:e,Start:n,ResetColors:a},t}(WORD_HILIGHT||{}),WORD_HILIGHT=function(t){function e(){t.allLetters=TXP.TanachData.Books.GetAllLetters(),t.allWords=TXP.TanachData.Books.GetAllWords(),TXP.Init(window.innerWidth,WORD_HILIGHT.GetTextureHeight(window.innerWidth),WORD_HILIGHT.configOptions.bgColor),wordsTexture=WORD_HILIGHT.GetWordsTexture(TXP.canvasWidth,TXP.canvasHeight),t.sprite=new PIXI.Sprite(wordsTexture),t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.x=t.sprite.width/2,t.sprite.y=t.sprite.height/2,t.sprite.scale.x*=-1,t.filter=new TXP.Shaders.MatchValueFilter,t.sprite.filters=[t.filter],TXP.stage.addChild(t.sprite),WORD_HILIGHT.Animation.Start(),WORD_HILIGHT.Controls.Start()}return t.Start=function(a){t.configOptions=a;var n=2;TXP.TanachData.Books.Load({onComplete:function(){--n||e()}}),TXP.Shaders.Load({vertex:["default"],fragment:["default","value-match"]},{onComplete:function(){--n||e()}})},t}(WORD_HILIGHT||{}),WORD_HILIGHT=function(t){function e(t){return Math.ceil(WORD_HILIGHT.allLetters.length/t)}return t.GetTextureHeight=e,t.GetWordsTexture=function(e,a){for(var n,o=0,r=0,i={},l=0,s=[];o<WORD_HILIGHT.allWords.length&&r<WORD_HILIGHT.allWords[o].length;){var u=WORD_HILIGHT.allWords[o];0==r&&(n=TXP.Utils.TextSubstitution.GetTextFromArray(u),i.hasOwnProperty(n)||(i[n]=l++)),s.push(i[n]),++r==u.length&&(o++,r=0)}return t.wordLookup=i,TXP.Utils.Texture.CreateNumbers(e,a,s,function(t){var e=WORD_HILIGHT.allWords[4],a=i[TXP.Utils.TextSubstitution.GetTextFromArray(e)],n=WORD_HILIGHT.allWords[0].concat(WORD_HILIGHT.allWords[1]).concat(WORD_HILIGHT.allWords[2]).concat(WORD_HILIGHT.allWords[3]).length;n*=4,4==a&&"השמים"==TXP.Utils.TextSubstitution.GetTextFromArray(e)||console.log("WRONG TEST WORD INDEX!"),(a>>16&255)==t.data[n]&&(a>>8&255)==t.data[n+1]&&(255&a)==t.data[n+2]?console.log("looks good from imgData side"):console.log("ERROR ON TEXTURE TEST!!!!!")})},t}(WORD_HILIGHT||{});